<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tinkr">
<title>Introduction to the tinkr package • tinkr</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the tinkr package">
<meta property="og:description" content="tinkr">
<meta property="og:image" content="https://docs.ropensci.org/tinkr/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">tinkr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="active nav-item">
  <a class="nav-link" href="../articles/tinkr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/tinkr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to the tinkr package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/tinkr/blob/HEAD/vignettes/tinkr.Rmd" class="external-link"><code>vignettes/tinkr.Rmd</code></a></small>
      <div class="d-none name"><code>tinkr.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tinkr/">tinkr</a></span><span class="op">)</span></span></code></pre></div>
<p>The goal of tinkr is to convert (R)Markdown files to XML and back to allow their editing with xml2 (XPath!) instead of numerous complicated regular expressions. If these words mean nothing to you, see our list of <a href="#background--pre-requisites">resources to get started</a>.</p>
<div class="section level2">
<h2 id="use-cases">Use Cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h2>
<p>Possible applications are R scripts using tinkr, and XPath via xml2 to:</p>
<ul>
<li>change levels of headers, cf <a href="https://github.com/ropensci/tinkr/blob/main/inst/scripts/roweb2_headers.R" class="external-link">our <code>roweb2_headers.R</code> script</a> and <a href="https://github.com/ropensci-archive/roweb2/pull/279" class="external-link">pull request #279 to roweb2</a>;</li>
<li>change chunk labels and options;</li>
<li>extract all runnable code (including inline code);</li>
<li>insert arbitrary Markdown elements;</li>
<li>modify link URLs;</li>
<li>your idea, please <a href="https://discuss.ropensci.org/c/usecases/10" class="external-link">report use cases</a>!</li>
</ul>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>Only the body of the (R) Markdown file is cast to XML, using the Commonmark specification via the <a href="https://github.com/r-lib/commonmark" class="external-link"><code>commonmark</code> package</a>. YAML metadata could be edited using the <a href="https://cran.r-project.org/package=yaml" class="external-link"><code>yaml</code> package</a>, which is not the goal of this package.</p>
<p>We have created an <a href="https://r6.r-lib.org/" class="external-link">R6 class</a> object called <strong>yarn</strong> to store the representation of both the YAML and the XML data, both of which are accessible through the <code>$body</code> and <code>$yaml</code> elements. In addition, the namespace prefix is set to “md” in the <code>$ns</code> element.</p>
<p>You can perform XPath queries using the <code>$body</code> and <code>$ns</code> elements:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/tinkr/">"tinkr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://xml2.r-lib.org/" class="external-link">"xml2"</a></span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example1.md"</span>, package <span class="op">=</span> <span class="st">"tinkr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "---"                                                                               </span></span>
<span><span class="co">#&gt; [2] "title: \"What have these birds been studied for? Querying science outputs with R\""</span></span>
<span><span class="co">#&gt; [3] "slug: birds-science"                                                               </span></span>
<span><span class="co">#&gt; [4] "authors:"                                                                          </span></span>
<span><span class="co">#&gt; [5] "  - name: Maëlle Salmon"                                                           </span></span>
<span><span class="co">#&gt; [6] "    url: https://masalmon.eu/"</span></span>
<span><span class="va">ex1</span> <span class="op">&lt;-</span> <span class="fu">tinkr</span><span class="fu">::</span><span class="va"><a href="../reference/yarn.html">yarn</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="co"># find all ropensci.org blog links</span></span>
<span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">ex1</span><span class="op">$</span><span class="va">body</span>, </span>
<span>  xpath <span class="op">=</span> <span class="st">".//md:link[contains(@destination,'ropensci.org/blog')]"</span>, </span>
<span>  ns <span class="op">=</span> <span class="va">ex1</span><span class="op">$</span><span class="va">ns</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (7)}</span></span>
<span><span class="co">#&gt; [1] &lt;link destination="https://ropensci.org/blog/2018/08/21/birds-radolfzell/ ...</span></span>
<span><span class="co">#&gt; [2] &lt;link destination="https://ropensci.org/blog/2018/09/04/birds-taxo-traits ...</span></span>
<span><span class="co">#&gt; [3] &lt;link destination="https://ropensci.org/blog/2018/08/21/birds-radolfzell/ ...</span></span>
<span><span class="co">#&gt; [4] &lt;link destination="https://ropensci.org/blog/2018/08/14/where-to-bird/" t ...</span></span>
<span><span class="co">#&gt; [5] &lt;link destination="https://ropensci.org/blog/2018/08/21/birds-radolfzell/ ...</span></span>
<span><span class="co">#&gt; [6] &lt;link destination="https://ropensci.org/blog/2018/08/28/birds-ocr/" title ...</span></span>
<span><span class="co">#&gt; [7] &lt;link destination="https://ropensci.org/blog/2018/09/04/birds-taxo-traits ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="markdown">Markdown<a class="anchor" aria-label="anchor" href="#markdown"></a>
</h3>
<p>This is a basic example. We read “example1.md”, change all headers 3 to headers 1, and save it back to md. Because the xml2 objects are <a href="https://blog.penjee.com/wp-content/uploads/2015/02/pass-by-reference-vs-pass-by-value-animation.gif" class="external-link">passed by reference</a>, manipulating them does not require reassignment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://magrittr.tidyverse.org" class="external-link">"magrittr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/tinkr/">"tinkr"</a></span><span class="op">)</span></span>
<span><span class="co"># From Markdown to XML</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example1.md"</span>, package <span class="op">=</span> <span class="st">"tinkr"</span><span class="op">)</span></span>
<span><span class="co"># Level 3 header example:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">path</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ### Getting a list of 50 species from occurrence data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For more details about the following code, refer to the [previous post</span></span>
<span><span class="co">#&gt; of the series](https://ropensci.org/blog/2018/08/21/birds-radolfzell/).</span></span>
<span><span class="co">#&gt; The single difference is our adding a step to keep only data for the</span></span>
<span><span class="co">#&gt; most recent years.</span></span>
<span><span class="va">ex1</span>  <span class="op">&lt;-</span> <span class="fu">tinkr</span><span class="fu">::</span><span class="va"><a href="../reference/yarn.html">yarn</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="co"># transform level 3 headers into level 1 headers</span></span>
<span><span class="va">ex1</span><span class="op">$</span><span class="va">body</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span>xpath <span class="op">=</span> <span class="st">".//md:heading[@level='3']"</span>, <span class="va">ex1</span><span class="op">$</span><span class="va">ns</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_attr.html" class="external-link">xml_set_attr</a></span><span class="op">(</span><span class="st">"level"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Back to Markdown</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">"md"</span><span class="op">)</span></span>
<span><span class="va">ex1</span><span class="op">$</span><span class="fu">write</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="co"># Level three headers are now Level one:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Getting a list of 50 species from occurrence data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For more details about the following code, refer to the [previous post</span></span>
<span><span class="co">#&gt; of the series](https://ropensci.org/blog/2018/08/21/birds-radolfzell/).</span></span>
<span><span class="co">#&gt; The single difference is our adding a step to keep only data for the</span></span>
<span><span class="co">#&gt; most recent years.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="r-markdown">R Markdown<a class="anchor" aria-label="anchor" href="#r-markdown"></a>
</h3>
<p>For R Markdown files, to ease editing of chunk label and options, <code>to_xml</code> munges the chunk info into different attributes. E.g. below you see that <code>code_blocks</code> can have a <code>language</code>, <code>name</code>, <code>echo</code> attributes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example2.Rmd"</span>, package <span class="op">=</span> <span class="st">"tinkr"</span><span class="op">)</span></span>
<span><span class="va">rmd</span> <span class="op">&lt;-</span> <span class="fu">tinkr</span><span class="fu">::</span><span class="va"><a href="../reference/yarn.html">yarn</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">rmd</span><span class="op">$</span><span class="va">body</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;document xmlns="http://commonmark.org/xml/1.0"&gt;</span></span>
<span><span class="co">#&gt;  [1] &lt;code_block xml:space="preserve" language="r" name="setup" include="FALS ...</span></span>
<span><span class="co">#&gt;  [2] &lt;heading level="2"&gt;\n  &lt;text xml:space="preserve"&gt;R Markdown&lt;/text&gt;\n&lt;/h ...</span></span>
<span><span class="co">#&gt;  [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is an &lt;/text&gt;\n  &lt;striket ...</span></span>
<span><span class="co">#&gt;  [4] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;When you click the &lt;/text&gt;\n   ...</span></span>
<span><span class="co">#&gt;  [5] &lt;code_block xml:space="preserve" language="r" name="" eval="TRUE" echo=" ...</span></span>
<span><span class="co">#&gt;  [6] &lt;heading level="2"&gt;\n  &lt;text xml:space="preserve"&gt;Including Plots&lt;/text&gt; ...</span></span>
<span><span class="co">#&gt;  [7] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;You can also embed plots, for  ...</span></span>
<span><span class="co">#&gt;  [8] &lt;code_block xml:space="preserve" language="python" name="" fig.cap="&amp;quo ...</span></span>
<span><span class="co">#&gt;  [9] &lt;code_block xml:space="preserve" language="python" name=""&gt;plot(pressure ...</span></span>
<span><span class="co">#&gt; [10] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;Non-RMarkdown blocks are also  ...</span></span>
<span><span class="co">#&gt; [11] &lt;code_block info="bash" xml:space="preserve" name=""&gt;echo "this is an un ...</span></span>
<span><span class="co">#&gt; [12] &lt;code_block xml:space="preserve" name=""&gt;This is an ambiguous code block ...</span></span>
<span><span class="co">#&gt; [13] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;Note that the &lt;/text&gt;\n  &lt;code ...</span></span>
<span><span class="co">#&gt; [14] &lt;table&gt;\n  &lt;table_header&gt;\n    &lt;table_cell align="left"&gt;\n      &lt;text xm ...</span></span>
<span><span class="co">#&gt; [15] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;blabla&lt;/text&gt;\n&lt;/paragraph&gt;</span></span></code></pre></div>
<p>Note that all of the features in tinkr work for both Markdown and R Markdown.</p>
</div>
<div class="section level3">
<h3 id="inserting-new-markdown-elements">Inserting new Markdown elements<a class="anchor" aria-label="anchor" href="#inserting-new-markdown-elements"></a>
</h3>
<p>Inserting new nodes into the AST is surprisingly difficult if there is a default namespace, so we have provided a method in the <strong>yarn</strong> object that will take plain Markdown and translate it to XML nodes and insert them into the document for you. For example, you can add a new code block:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example2.Rmd"</span>, package <span class="op">=</span> <span class="st">"tinkr"</span><span class="op">)</span></span>
<span><span class="va">rmd</span> <span class="op">&lt;-</span> <span class="fu">tinkr</span><span class="fu">::</span><span class="va"><a href="../reference/yarn.html">yarn</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_first</a></span><span class="op">(</span><span class="va">rmd</span><span class="op">$</span><span class="va">body</span>, <span class="st">".//md:code_block"</span>, <span class="va">rmd</span><span class="op">$</span><span class="va">ns</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_node}</span></span>
<span><span class="co">#&gt; &lt;code_block space="preserve" language="r" name="setup" include="FALSE" eval="TRUE"&gt;</span></span>
<span><span class="va">new_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"```{r xml-block, message = TRUE}"</span>,</span>
<span>  <span class="st">"message(\"this is a new chunk from {tinkr}\")"</span>,</span>
<span>  <span class="st">"```"</span><span class="op">)</span></span>
<span><span class="va">new_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  package <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xml2"</span>, <span class="st">"xslt"</span>, <span class="st">"commonmark"</span>, <span class="st">"tinkr"</span><span class="op">)</span>,</span>
<span>  cool <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Add chunk into document after the first chunk</span></span>
<span><span class="va">rmd</span><span class="op">$</span><span class="fu">add_md</span><span class="op">(</span><span class="va">new_code</span>, where <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span>
<span><span class="co"># Add a table after the second chunk:</span></span>
<span><span class="va">rmd</span><span class="op">$</span><span class="fu">add_md</span><span class="op">(</span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">new_table</span><span class="op">)</span>, where <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="co"># show the first 21 lines of modified document</span></span>
<span><span class="va">rmd</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="fl">21</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; title: "Untitled"</span></span>
<span><span class="co">#&gt; author: "M. Salmon"</span></span>
<span><span class="co">#&gt; date: "September 6, 2018"</span></span>
<span><span class="co">#&gt; output: html_document</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ```{r setup, include=FALSE, eval=TRUE}</span></span>
<span><span class="co">#&gt; knitr::opts_chunk$set(echo = TRUE)</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ```{r xml-block, message=TRUE}</span></span>
<span><span class="co">#&gt; message("this is a new chunk from {tinkr}")</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | package                    | cool                | </span></span>
<span><span class="co">#&gt; | :------------------------- | :------------------ |</span></span>
<span><span class="co">#&gt; | xml2                       | TRUE                | </span></span>
<span><span class="co">#&gt; | xslt                       | TRUE                | </span></span>
<span><span class="co">#&gt; | commonmark                 | TRUE                | </span></span>
<span><span class="co">#&gt; | tinkr                      | TRUE                |</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="background-pre-requisites">Background / pre-requisites<a class="anchor" aria-label="anchor" href="#background-pre-requisites"></a>
</h2>
<p>If you are not closely following one of the examples provided, what background knowledge do you need before using tinkr?</p>
<ul>
<li>That XPath, a language for querying XML &amp; HTML, exists, and <a href="https://www.w3schools.com/xml/xpath_intro.asp" class="external-link">some basics</a>.</li>
<li>Basics of how <a href="https://blog.r-hub.io/2020/01/22/mutable-api/#exposing-the-c-api-in-xml2" class="external-link">xml2 works</a>: how to find, replace, remove nodes etc.</li>
<li>How to use R6 classes… although reading the examples should help you get the gist.</li>
<li>If you are not happy with <a href="#general-principles-and-solution">our default stylesheet</a>, then understanding <a href="https://ropensci.org/blog/2017/01/10/xslt-release/" class="external-link">XSLT</a> will help you create your own. Refer to this good resource on <a href="https://www.w3schools.com/xml/xsl_intro.asp" class="external-link">XSLT for XML transformations</a>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="loss-of-markdown-style">Loss of Markdown style<a class="anchor" aria-label="anchor" href="#loss-of-markdown-style"></a>
</h2>
<div class="section level3">
<h3 id="general-principles-and-solution">General principles and solution<a class="anchor" aria-label="anchor" href="#general-principles-and-solution"></a>
</h3>
<p>The (R)md to XML to (R)md loop on which <code>tinkr</code> is based is slightly lossy because of Markdown syntax redundancy, so the loop from (R)md to R(md) via <code>to_xml</code> and <code>to_md</code> will be a bit lossy. For instance</p>
<ul>
<li><p>lists can be created with either “+”, “-” or “*“. When using <code>tinkr</code>, the (R)md after editing will only use”-” for lists.</p></li>
<li><p>Links built like <code>[word][smallref]</code> with a bottom anchor <code>[smallref]: URL</code> will have the anchor moved to the bottom of the document.</p></li>
<li><p>Characters are escaped (e.g. “[” when not for a link).</p></li>
<li><p><input type="checkbox" disabled checked>
GitHub tickboxes are preserved (only for <code>yarn</code> objects)</p></li>
<li><p>Block quotes lines all get “&gt;” whereas in the input only the first could have a “&gt;” at the beginning of the first line.</p></li>
<li><p>For tables see the next subsection.</p></li>
</ul>
<p>Such losses make your (R)md different, and the git diff a bit harder to parse, but should <em>not</em> change the documents your (R)md is rendered to. If it does, report a bug in the issue tracker!</p>
<p>A solution to not loose your Markdown style, e.g. your preferring “*” over “-” for lists is to tweak <a href="https://github.com/ropensci/tinkr/blob/main/inst/stylesheets/xml2md_gfm.xsl" class="external-link">our XSL stylesheet</a> and provide its filepath as <code>stylesheet_path</code> argument to <code>to_md</code>.</p>
</div>
<div class="section level3">
<h3 id="the-special-case-of-tables">The special case of tables<a class="anchor" aria-label="anchor" href="#the-special-case-of-tables"></a>
</h3>
<ul>
<li>Tables are supposed to remain/become pretty after a full loop <code>to_xml</code> + <code>to_md</code>. If you notice something amiss, e.g. too much space compared to what you were expecting, please open an issue.</li>
</ul>
</div>
<div class="section level3">
<h3 id="latex-equations">LaTeX equations<a class="anchor" aria-label="anchor" href="#latex-equations"></a>
</h3>
<p>While Markdown parsers like pandoc know what LaTeX is, commonmark does not, and that means LaTeX equations will end up with extra markup due to commonmark’s desire to escape characters.</p>
<p>However, if you have LaTeX equations that use either <code>$</code> or <code>$$</code> to delimit them, you can protect them from formatting changes with the <code>$protect_math()</code> method (for users of the <code>yarn</code> object) or the <code><a href="../reference/protect_math.html">protect_math()</a></code> function (for those using the output of <code><a href="../reference/to_xml.html">to_xml()</a></code>). Below is a demonstration using the <code>yarn</code> object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"math-example.md"</span>, package <span class="op">=</span> <span class="st">"tinkr"</span><span class="op">)</span></span>
<span><span class="va">math</span> <span class="op">&lt;-</span> <span class="fu">tinkr</span><span class="fu">::</span><span class="va"><a href="../reference/yarn.html">yarn</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">math</span><span class="op">$</span><span class="fu">tail</span><span class="op">(</span><span class="op">)</span> <span class="co"># malformed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $$</span></span>
<span><span class="co">#&gt; Q\_{N(norm)}=\\frac{C\_N +C\_{N-1}}2\\times</span></span>
<span><span class="co">#&gt; \\frac{\\sum *{i=N-n}^{N}Q\_i} {\\sum*{j=N-n}^{N}{(\\frac{C\_j+C\_{j-1}}2)}}</span></span>
<span><span class="co">#&gt; $$</span></span>
<span><span class="va">math</span><span class="op">$</span><span class="fu">protect_math</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">tail</span><span class="op">(</span><span class="op">)</span> <span class="co"># success!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $$</span></span>
<span><span class="co">#&gt; Q_{N(norm)}=\frac{C_N +C_{N-1}}2\times</span></span>
<span><span class="co">#&gt; \frac{\sum _{i=N-n}^{N}Q_i} {\sum_{j=N-n}^{N}{(\frac{C_j+C_{j-1}}2)}}</span></span>
<span><span class="co">#&gt; $$</span></span></code></pre></div>
<p>Note, however, that there are a few caveats for this:</p>
<ol style="list-style-type: decimal">
<li><p>The dollar notation for inline math must be adjacent to the text. E.G. <code>$\alpha$</code> is valid, but <code>$ \alpha$</code> and <code>$\alpha $</code> are not valid.</p></li>
<li><p>We do not currently have support for bracket notation</p></li>
<li>
<p>If you use a postfix dollar sign in your prose (e.g. BASIC commands or a Burroughs-Wheeler Transformation demonstration), you must be sure to either use punctuation after the trailing dollar sign OR format the text as code. (i.e. <code>`INKEY$`</code> is good, but <code>INKEY$</code> by itself is not good and will be interpreted as LaTeX code, throwing an error:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"basic-math.md"</span>, package <span class="op">=</span> <span class="st">"tinkr"</span><span class="op">)</span></span>
<span><span class="va">math</span> <span class="op">&lt;-</span> <span class="fu">tinkr</span><span class="fu">::</span><span class="va"><a href="../reference/yarn.html">yarn</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">math</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="co"># malformed</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; title: basic math</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; BASIC programming can make things weird:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Give you $2 to tell me what INKEY$ means.</span></span>
<span><span class="co">#&gt; - Give you $2 to *show* me what INKEY$ means.</span></span>
<span><span class="co">#&gt; - Give you $2 to *show* me what `INKEY$` means.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Postfix dollars mixed with prefixed dollars can make things weird:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - We write $2 but say 2$ verbally.</span></span>
<span><span class="co">#&gt; - We write $2 but *say* 2$ verbally.</span></span>
<span><span class="va">math</span><span class="op">$</span><span class="fu">protect_math</span><span class="op">(</span><span class="op">)</span> <span class="co">#error</span></span>
<span><span class="co">#&gt; Error: Inline math delimiters are not balanced.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; HINT: If you are writing BASIC code, make sure you wrap variable</span></span>
<span><span class="co">#&gt;       names and code in backtics like so: `INKEY$`.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Below are the pairs that were found:</span></span>
<span><span class="co">#&gt;            start...end</span></span>
<span><span class="co">#&gt;            -----...---</span></span>
<span><span class="co">#&gt;  Give you $2 to ... me what INKEY$ means.</span></span>
<span><span class="co">#&gt;  Give you $2 to ... 2$ verbally.</span></span>
<span><span class="co">#&gt; We write $2 but ...</span></span></code></pre></div>
</li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
